cmake_minimum_required(VERSION 3.20)

project(i18n_clang LANGUAGES CXX)

add_executable(tool)
add_library(i18n MODULE)
add_library(clang_common OBJECT)

find_package(Clang REQUIRED)

target_sources(clang_common PRIVATE attr.cpp ../common/write_po.cpp)
target_sources(tool PRIVATE tool.cpp action.cpp)
target_sources(i18n PRIVATE plugin.cpp)
target_link_libraries(i18n PRIVATE clang_common)
target_link_libraries(tool PRIVATE clang_common)
target_link_libraries(tool PRIVATE clang-cpp LLVM)
set_target_properties(clang_common PROPERTIES POSITION_INDEPENDENT_CODE ON)
set_target_properties(i18n PROPERTIES PREFIX "")
target_include_directories(clang_common PUBLIC ${LLVM_INCLUDE_DIRS})
target_compile_definitions(clang_common PUBLIC ${LLVM_DEFINITIONS})
target_compile_features(clang_common PUBLIC cxx_std_17)
if(${LLVM_ENABLE_RTTI})
  target_compile_options(clang_common PUBLIC -frtti)
else()
  target_compile_options(clang_common PUBLIC -fno-rtti)
endif()
target_link_options(i18n PRIVATE -fuse-ld=lld)
target_link_options(tool PRIVATE -fuse-ld=lld)
